!function(){"use strict";angular.module("HousePointsApp",["ui.router","ngCookies","restangular","ngAnimate","LocalStorageModule"]).constant("StateErrorCodes",{Unauthenticated:"User not authenticated",Unauthorized:"Unauthorized"}).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$animateProvider",function(e,t,r,o,n){function l(e,t,r,o){var n=t.defer();return r.getAuthToken()?e.isLoggedInPromise().then(function(){o.logMessage({message:"logging out",caller:"app - isAlreadyLoggedIn"}),e.logout(),n.resolve()},function(){n.resolve()}):n.resolve(),n.promise}function a(e,t,r){var o=t.defer(),n=this.self;return e.isLoggedInPromise()?e.isLoggedInPromise().then(function(e){n&&n.role?n.role===e.user.role?o.resolve():(logger.logMessage({message:"not authorized to the page.",caller:"app - isAuthenticated"}),o.reject({message:r.Unauthorized,next:"unauthorized"})):o.resolve()},function(){logger.logMessage({message:"Loggedin promise returned error",caller:"app - isAuthenticated"}),o.reject({message:r.Unauthenticated,next:"login"})}):(logger.logMessage({message:"not logged in",caller:"app - isAuthenticated"}),o.reject({message:r.Unauthenticated,next:"login"})),o.promise}n.classNameFilter(/animate/),e.state("main",{url:"/",templateUrl:"main/main.html",controller:"mainController as mainVm",resolve:{isAuthenticated:a}}).state("unauthorized",{url:"/unauthorized",templateUrl:"Unauthorized.html"}).state("404",{url:"/notFound",templateUrl:"404.html"}).state("admin",{url:"/admin",templateUrl:"admin/admin.html",controller:"adminController as adminVm",resolve:{isAuthenticated:a,Users:["UserService","isAuthenticated",function(e){return e.getAllUsers()}]},role:"admin"}).state("login",{url:"/login",templateUrl:"login/login.html",controller:"loginController as loginVm",resolve:{isAlreadyLoggedIn:l}}).state("register",{url:"/register",templateUrl:"Register/register.html",controller:"registerController as registerVm",resolve:{isAlreadyLoggedIn:l}}).state("log",{url:"/log",templateUrl:"log/log.html",controller:"logController as logVm"}),t.otherwise("/notFound"),r.html5Mode({enabled:!0,requireBase:!1}),o.interceptors.push("authInterceptor"),l.$inject=["AuthService","$q","StorageService","logger"],a.$inject=["AuthService","$q","StateErrorCodes"]}]).run(["$rootScope","StateErrorCodes","$state",function(e,t,r){e.$on("$stateChangeError",function(e,t,o,n,l,a){a.next&&r.transitionTo(a.next)})}])}();
!function(e){"use strict";e.directive("emailAvailableValidator",["$q","$timeout","UserService",function(e,a,i){return{restrict:"A",require:"ngModel",link:function(a,l,r,t){t.$asyncValidators.emailAvailable=function(a){var l=e.defer();return i.checkUser(a).then(function(e){logger.logMessage({message:"isAvailable: "+e.available,caller:"emailAvailableValidator"}),e.available?l.resolve():l.reject()}),l.promise}}}}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.controller("registerController",["UserService","$state","AuthService",function(e,r,t){function o(o,n){o&&e.createUser(n).then(function(){logger.logMessage({message:"redirecting to main",caller:"registerController.submit"}),t.login(n).then(function(){r.go("main")})},function(){logger.logMessage({message:"error creating user",caller:"registerController.submit"})})}function n(){s.user={email:"",password:"",name:""},s.error=void 0}var s=this;s.user={},s.submit=o,n()}])}(angular.module("HousePointsApp"));
!function(o){"use strict";o.controller("logController",["logger",function(o){var l=this;l.logger=o}])}(angular.module("HousePointsApp"));
!function(n){"use strict";n.controller("loginController",["AuthService","$state",function(n,o){function t(t,r){t&&n.login(r).then(function(){o.go("main")},function(n){i.error=n})}function r(){i.user={email:"",password:""},i.error=void 0}var i=this;i.user={},i.submit=t,i.Auth=n,r()}])}(angular.module("HousePointsApp"));
!function(r){"use strict";r.controller("adminController",["Users",function(r){var s=this;s.users=[],angular.isArray(r)&&r.forEach(function(r){s.users.push(r)})}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.directive("ajUser",function(){return{restrict:"E",replace:!0,scope:{user:"="},templateUrl:"admin/user.html"}})}(angular.module("HousePointsApp"));
!function(t){"use strict";t.controller("mainController",["AuthService",function(t){var n=this;n.Auth=t}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("AuthService",["$http","$q","UserService","StorageService","logger",function(e,n,t,r,o){function u(){return a.hasOwnProperty("role")}function i(e){return a&&l.isLoggedIn()?a.role===e:!1}function c(){o.logMessage({caller:"AuthService.init"}),r.getAuthToken()&&(f=t.getLoggedInUser(),f.then(function(e){a=e.user}))}function s(){o.logMessage({caller:"AuthService.logout"}),a={},f=void 0,r.removeAuthToken()}function g(u){o.logMessage({caller:"AuthService.login"});var i=n.defer();return e.post("/auth/local",u).success(function(e){r.putAuthToken(e.token),f=t.getLoggedInUser(),f.then(function(e){a=e.user,i.resolve()},function(e){i.reject(e)})}).error(function(e){r.removeAuthToken(),i.reject(e)}),i.promise}var l,f,a={};return l={login:g,logout:s,getCurrentUser:function(){return a},setCurrentUser:function(e){a=e},isLoggedIn:u,isLoggedInPromise:function(){return f},hasRole:i},c(),l}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("logger",function s(){function e(e){var t=new a(e);s.messageLog.push(t)}function t(){s.messageLog=[]}function a(e){this.message=e.message||"",this.type=e.type||"",this.caller=e.caller||"",this.time=new Date}var s={};return s.messageLog=[],s.logMessage=e,s.clear=t,s})}(angular.module("HousePointsApp"),_);
!function(e){"use strict";e.factory("StorageService",["localStorageService",function(e){function t(){return e.get("token")}function n(){e.remove("token")}function o(t){null!==t&&void 0!==t&&e.set("token",t)}var u={getAuthToken:t,removeAuthToken:n,putAuthToken:o};return u}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("UserService",["Restangular","capitalizeFilter","$q",function(e,t,n){function r(){return c.one("me").get()}function s(e){var t=n.defer();return c.post(e).then(function(){t.resolve()},function(){t.reject()}),t.promise}function u(){return c.getList()}function o(e){return c.one("checkUser",e).get()}var i=e.withConfig(function(e){e.addResponseInterceptor(function(e,n,r){var s=e;return"get"===n&&"me"===r&&(s.user.name=t(s.user.name)),"getList"===n&&(s=e.users),s})}),c=i.all("api/users");return{getLoggedInUser:r,getAllUsers:u,checkUser:o,createUser:s}}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("authInterceptor",["$rootScope","$q","StorageService","$location",function(e,t,r,o){return{request:function(e){return e.headers=e.headers||{},r.getAuthToken()&&(e.headers.Authorization="Bearer "+r.getAuthToken()),e},responseError:function(e){return 401===e.status?(o.path("/login"),t.reject(e)):t.reject(e)}}}])}(angular.module("HousePointsApp"));
!function(t){"use strict";t.directive("ajNavbar",["AuthService","$state",function(t,o){return{restrict:"EA",templateUrl:"Common/NavBar/NavBar.html",controller:function(){var r=this;r.isCollapsed=!0,r.Auth=t,r.logout=function(){r.Auth.logout(),r.isCollapsed=!0,o.go("login")}},controllerAs:"navBarVm"}}])}(angular.module("HousePointsApp"));
!function(t){"use strict";t.filter("capitalize",function(){return function(t){if(!t)return"";var n=t.substring(0,1).toUpperCase();return n+t.substring(1)}})}(angular.module("HousePointsApp"));
!function(e){"use strict";e.directive("loader",["$rootScope","$timeout","logger",function(e,a,t){return{restrict:"A",replace:!0,templateUrl:"Common/directives/loader/loader.html",link:function(s,n,o){var r,i=o.minLoaderDisplay||300;s.data={startTime:void 0};var l=e.$on("$stateChangeStart",function(){s.data.startTime=new Date,n.removeClass("ng-hide")}),c=e.$on("$stateChangeSuccess",function(e,o,l,c){t.logMessage({message:"from "+c.name+" to "+o.name,caller:"loader - $stateChangeSuccess"});var d=new Date-s.data.startTime;t.logMessage({message:"state Transition time: "+d+" ms",caller:"loader - $stateChangeSuccess"});var g=i-d;g=g>0?g:0,r=a(function(){n.addClass("ng-hide")},g)}),d=e.$on("$stateChangeError",function(){n.addClass("ng-hide")});s.$on("destroy",function(){t.logMessage({message:"unregistering",caller:"loader - destroy"}),l(),c(),d(),a.cancel(r)})}}}])}(angular.module("HousePointsApp"));