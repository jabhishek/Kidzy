!function(){"use strict";angular.module("HousePointsApp",["ui.router","ngCookies","restangular","ngAnimate","LocalStorageModule"]).constant("StateErrorCodes",{Unauthenticated:"User not authenticated",Unauthorized:"Unauthorized"}).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$animateProvider",function(e,t,r,o,n){function i(e,t,r){var o=t.defer();return r.getAuthToken()?e.isLoggedInPromise().then(function(){e.logout(),o.resolve()},function(){o.resolve()}):o.resolve(),o.promise}function l(e,t,r){var o=t.defer(),n=this.self;return e.isLoggedInPromise()?e.isLoggedInPromise().then(function(e){n&&n.role?n.role===e.user.role?o.resolve():(console.log("not authorized to the page."),o.reject({message:r.Unauthorized,next:"unauthorized"})):o.resolve()},function(){console.log("Loggedin promise returned error"),o.reject({message:r.Unauthenticated,next:"login"})}):(console.log("not logged in"),o.reject({message:r.Unauthenticated,next:"login"})),o.promise}n.classNameFilter(/animate/),e.state("main",{url:"/",templateUrl:"main/main.html",controller:"mainController as mainVm",resolve:{isAuthenticated:l}}).state("unauthorized",{url:"/unauthorized",templateUrl:"Unauthorized.html"}).state("404",{url:"/notFound",templateUrl:"404.html"}).state("admin",{url:"/admin",templateUrl:"admin/admin.html",controller:"adminController as adminVm",resolve:{isAuthenticated:l,Users:["UserService","isAuthenticated",function(e){return e.getAllUsers()}]},role:"admin"}).state("login",{url:"/login",templateUrl:"login/login.html",controller:"loginController as loginVm",resolve:{isAlreadyLoggedIn:i}}).state("register",{url:"/register",templateUrl:"Register/register.html",controller:"registerController as registerVm",resolve:{isAlreadyLoggedIn:i}}),t.otherwise("/notFound"),r.html5Mode({enabled:!0,requireBase:!1}),o.interceptors.push("authInterceptor"),i.$inject=["AuthService","$q","StorageService"],l.$inject=["AuthService","$q","StateErrorCodes"]}]).run(["$rootScope","StateErrorCodes","$state",function(e,t,r){e.$on("$stateChangeError",function(e,t,o,n,i,l){l.next&&r.transitionTo(l.next)})}])}();
!function(r){"use strict";r.controller("adminController",["Users",function(r){var s=this;s.users=[],angular.isArray(r)&&r.forEach(function(r){s.users.push(r)})}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.directive("ajUser",function(){return{restrict:"E",replace:!0,scope:{user:"="},templateUrl:"admin/user.html"}})}(angular.module("HousePointsApp"));
!function(e){"use strict";e.directive("emailAvailableValidator",["$q","$timeout","UserService",function(e,i,a){return{restrict:"A",require:"ngModel",link:function(i,l,r,n){n.$asyncValidators.emailAvailable=function(i){var l=e.defer();return a.checkUser(i).then(function(e){console.log("isAvailable: "+e.available),e.available?l.resolve():l.reject()}),l.promise}}}}])}(angular.module("HousePointsApp"));
!function(r){"use strict";r.controller("registerController",function(){function r(){o.user={email:"",password:""},o.error=void 0}var o=this;o.user={},r()})}(angular.module("HousePointsApp"));
!function(n){"use strict";n.controller("loginController",["AuthService","$state",function(n,o){function t(t,r){t&&n.login(r).then(function(){o.go("main")},function(n){i.error=n})}function r(){i.user={email:"",password:""},i.error=void 0}var i=this;i.user={},i.submit=t,i.Auth=n,r()}])}(angular.module("HousePointsApp"));
!function(t){"use strict";t.controller("mainController",["AuthService",function(t){var n=this;n.Auth=t}])}(angular.module("HousePointsApp"));
!function(t){"use strict";t.directive("ajNavbar",["AuthService","$state",function(t,o){return{restrict:"EA",templateUrl:"Common/NavBar/NavBar.html",controller:function(){var r=this;r.isCollapsed=!0,r.Auth=t,r.logout=function(){r.Auth.logout(),r.isCollapsed=!0,o.go("login")}},controllerAs:"navBarVm"}}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("AuthService",["$http","$q","UserService","StorageService",function(e,n,t,r){function o(){return h.hasOwnProperty("role")}function u(e){return h&&g.isLoggedIn()?h.role===e:!1}function i(){r.getAuthToken()&&(f=t.getLoggedInUser(),f.then(function(e){h=e.user}))}function c(){h={},r.removeAuthToken()}function s(o){var u=n.defer();return e.post("/auth/local",o).success(function(e){r.putAuthToken(e.token),f=t.getLoggedInUser(),f.then(function(e){h=e.user,u.resolve()},function(e){u.reject(e)})}).error(function(e){r.removeAuthToken(),u.reject(e)}),u.promise}var g,f,h={};return g={login:s,logout:c,getCurrentUser:function(){return h},setCurrentUser:function(e){h=e},isLoggedIn:o,isLoggedInPromise:function(){return f},hasRole:u},i(),g}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("StorageService",["localStorageService",function(e){function t(){return e.get("token")}function n(){e.remove("token")}function o(t){null!==t&&void 0!==t&&e.set("token",t)}var u={getAuthToken:t,removeAuthToken:n,putAuthToken:o};return u}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("UserService",["Restangular","capitalizeFilter",function(e,t){function n(){return i.one("me").get()}function r(){return i.getList()}function s(e){return i.one("checkUser",e).get()}var u=e.withConfig(function(e){e.addResponseInterceptor(function(e,n,r){var s=e;return"get"===n&&"me"===r&&(s.user.name=t(s.user.name)),"getList"===n&&(s=e.users),s})}),i=u.all("api/users");return{getLoggedInUser:n,getAllUsers:r,checkUser:s}}])}(angular.module("HousePointsApp"));
!function(e){"use strict";e.factory("authInterceptor",["$rootScope","$q","StorageService","$location",function(e,t,r,o){return{request:function(e){return e.headers=e.headers||{},r.getAuthToken()&&(e.headers.Authorization="Bearer "+r.getAuthToken()),e},responseError:function(e){return 401===e.status?(o.path("/login"),t.reject(e)):t.reject(e)}}}])}(angular.module("HousePointsApp"));
!function(t){"use strict";t.filter("capitalize",function(){return function(t){if(!t)return"";var n=t.substring(0,1).toUpperCase();return n+t.substring(1)}})}(angular.module("HousePointsApp"));
!function(e){"use strict";e.directive("loader",["$rootScope","$timeout",function(e,t){return{restrict:"A",link:function(o,n){var a;o.data={startTime:void 0};var s=e.$on("$stateChangeStart",function(e,t,a,s){console.group("loader - $stateChangeStart"),console.log("from "+s.name+" to "+t.name),o.data.startTime=new Date,console.log("start time"),console.log(o.data.startTime),n.removeClass("ng-hide"),console.groupEnd("$stateChangeStart")}),r=e.$on("$stateChangeSuccess",function(e,s,r,c){console.group("loader - $stateChangeSuccess"),console.log("from "+c.name+" to "+s.name),console.log("state Transition time: "+(new Date-o.data.startTime)+" ms"),a=t(function(){n.addClass("ng-hide")},300),console.groupEnd("$stateChangeSuccess")}),c=e.$on("$stateChangeError",function(){n.addClass("ng-hide")});o.$on("destroy",function(){console.log("unregistering"),s(),r(),c(),t.cancel(a)})}}}])}(angular.module("HousePointsApp"));